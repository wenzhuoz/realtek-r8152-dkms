#!/bin/sh
# Copyright (C) 2002-2005 Flavio Stanchina
# Copyright (C) 2005-2006 Aric Cyr
# Copyright (C) 2007 Mario Limonciello
# Copyright (C) 2009 Alberto Milone
# Copyright (C) 2020-2022 Deokgyu Yang

set -e

NAME=realtek-r8152
PACKAGE_NAME=$NAME-dkms
VERSION=`dpkg-query -W -f='${Version}' $PACKAGE_NAME | awk -F "-" '{print $1}'`
ARCH=`dpkg --print-architecture`

msg() {
	echo "realtek-r8152-dkms: $@"
}

dkms_configure () {
	for POSTINST in /usr/lib/dkms/common.postinst "/usr/share/$PACKAGE_NAME/postinst"; do
		if [ -f "$POSTINST" ]; then
			"$POSTINST" "$NAME" "$VERSION" "/usr/share/$PACKAGE_NAME" "$ARCH" "$2"
			return $?
		fi
		msg "WARNING: $POSTINST does not exist." >&2
	done
	msg "ERROR: DKMS version is too old and $PACKAGE_NAME was not" >&2
	msg "built with legacy DKMS support." >&2
	msg "You must either rebuild $PACKAGE_NAME with legacy postinst" >&2
	msg "support or upgrade DKMS to a more current version." >&2
	return 1
}

udev_configure() {
	msg "Reload udev rules..."
	[ -x "$(command -v udevadm)" ] && {
		udevadm control --reload
		udevadm trigger
	} || msg "udevadm not found. Please reboot to take effect."
}

case "$1" in
	configure)
		dkms_configure
		udev_configure
	;;

	abort-upgrade|abort-remove|abort-deconfigure)
	;;

	*)
		msg "postinst called with unknown argument \`$1'" >&2
		exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
